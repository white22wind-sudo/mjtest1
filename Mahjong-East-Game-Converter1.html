<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>모탈복기용 작혼 동풍전 변환기 </title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { padding: 10px 20px; font-size: 16px; }

    /* 입력창 */
    textarea {
      width: 90%;
      height: 200px;
      margin-bottom: 10px;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.4;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      resize: both;
      white-space: pre-wrap;   /* 자동 줄바꿈 */
      word-break: break-word;  /* 너무 긴 단어도 줄바꿈 */
      overflow-y: auto;
    }

    /* 출력창 */
    pre {
      width: 90%;
      height: 400px;
      margin-top: 20px;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.4;
      background: #eee;
      border-radius: 6px;
      padding: 20px;
      white-space: pre-wrap;   /* 자동 줄바꿈 */
      word-break: break-word;
       overflow-y: auto;
    }

    /* 변환 결과 제목+복사 버튼 한 줄로 */
    #resultHeader {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div style="display: flex; align-items: baseline; gap: 10px;">
    <h1 style="margin: 0;">작혼 동풍전 변환기</h1>
    <small style="color: #555;">(동풍전을 모탈에서 복기 가능하게 변환)</small>
  </div>
  <p>
    여러 줄 붙여넣고 <strong>“변환하기”</strong> 누르면<br />
    모든 log를 병합한 하나의 패보가 나온다!
  </p>
  <textarea id="inputArea" placeholder="https://tenhou.net/6/#json=... 을 전부 붙여넣기!"></textarea>
  <br />
  <button onclick="convertUrls()">변환하기</button>

  <div id="resultHeader">
    <h2 style="margin:0;">변환 결과</h2>
    <button id="copyBtn" onclick="copyResult()">복사하기</button>
  </div>
  <pre id="outputArea"></pre>

  <script>
    function convertUrls() {
      const input = document.getElementById('inputArea').value.trim();
      if (!input) {
        alert('Custom log (tenhou.net/6 JSON) 을 입력해주세요');
        return;
      }

      const lines = input.split('\n');
      const combinedLogs = [];
      let firstData = null;
      const errors = [];

      lines.forEach((line, idx) => {
        const trimmed = line.trim();
        if (trimmed === '') return; // 빈 줄 무시

        try {
          const jsonStr = trimmed.replace(/^https:\/\/tenhou\.net\/6\/#json=/, '');
          const data = JSON.parse(jsonStr);

          if (data.title?.[0]?.[0]) {
            data.title[0][0] = data.title[0][0].replace(/東/g, '南');
          }
          if (data.rule?.disp) {
            data.rule.disp = data.rule.disp.replace(/東/g, '南');
          }

          if (Array.isArray(data.log) && data.log.length > 0 && Array.isArray(data.log[0]) && Array.isArray(data.log[0][0])) {
            data.log[0][0][0] += 4;
          }

          if (!firstData) {
            firstData = data;
          }

          combinedLogs.push(...data.log);

        } catch (e) {
          errors.push(`⚠️ ${idx + 1}번째 줄 변환 실패: ${e.message}\n👉 원본: ${trimmed}`);
        }
      });

      if (!firstData) {
        document.getElementById('outputArea').textContent = '변환할 유효한 JSON 데이터가 없어요!';
        return;
      }

      firstData.log = combinedLogs;
      const resultJson = JSON.stringify(firstData);

      // "]]]," 패턴을 찾아서 줄바꿈으로 대체합니다.
      const formattedResult = resultJson.replace(/\]\],/g, ']],\n\n');

      if (errors.length > 0) {
        document.getElementById('outputArea').textContent = errors.join('\n\n') + '\n\n==== 변환된 결과 ====\n\n' + formattedResult;
      } else {
        document.getElementById('outputArea').textContent = formattedResult;
      }
    }

    function copyResult() {
      const output = document.getElementById('outputArea').textContent;
      if (!output) {
        alert('복사할 변환 결과가 없어요!');
        return;
      }

      navigator.clipboard.writeText(output).then(() => {
        alert('변환 결과가 클립보드에 복사됐어요!');
      }).catch(() => {
        alert('복사 실패! 직접 드래그해서 복사해봐요.');
      });
    }
  </script>
</body>
</html>


