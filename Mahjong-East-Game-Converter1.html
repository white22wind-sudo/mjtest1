<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ëª¨íƒˆë³µê¸°ìš© ì‘í˜¼ ë™í’ì „ ë³€í™˜ê¸° </title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { padding: 10px 20px; font-size: 16px; }

    /* ì…ë ¥ì°½ */
    textarea {
      width: 90%;
      height: 200px;
      margin-bottom: 10px;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.4;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      resize: both;
      white-space: pre-wrap;   /* ìë™ ì¤„ë°”ê¿ˆ */
      word-break: break-word;  /* ë„ˆë¬´ ê¸´ ë‹¨ì–´ë„ ì¤„ë°”ê¿ˆ */
      overflow-y: auto;
    }

    /* ì¶œë ¥ì°½ */
    pre {
      width: 90%;
      height: 400px;
      margin-top: 20px;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.4;
      background: #eee;
      border-radius: 6px;
      padding: 20px;
      white-space: pre-wrap;   /* ìë™ ì¤„ë°”ê¿ˆ */
      word-break: break-word;
       overflow-y: auto;
    }

    /* ë³€í™˜ ê²°ê³¼ ì œëª©+ë³µì‚¬ ë²„íŠ¼ í•œ ì¤„ë¡œ */
    #resultHeader {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div style="display: flex; align-items: baseline; gap: 10px;">
    <h1 style="margin: 0;">ì‘í˜¼ ë™í’ì „ ë³€í™˜ê¸°</h1>
    <small style="color: #555;">(ë™í’ì „ì„ ëª¨íƒˆì—ì„œ ë³µê¸° ê°€ëŠ¥í•˜ê²Œ ë³€í™˜)</small>
  </div>
  <p>
    ì—¬ëŸ¬ ì¤„ ë¶™ì—¬ë„£ê³  <strong>â€œë³€í™˜í•˜ê¸°â€</strong> ëˆ„ë¥´ë©´<br />
    ëª¨ë“  logë¥¼ ë³‘í•©í•œ í•˜ë‚˜ì˜ íŒ¨ë³´ê°€ ë‚˜ì˜¨ë‹¤!
  </p>
  <textarea id="inputArea" placeholder="https://tenhou.net/6/#json=... ì„ ì „ë¶€ ë¶™ì—¬ë„£ê¸°!"></textarea>
  <br />
  <button onclick="convertUrls()">ë³€í™˜í•˜ê¸°</button>

  <div id="resultHeader">
    <h2 style="margin:0;">ë³€í™˜ ê²°ê³¼</h2>
    <button id="copyBtn" onclick="copyResult()">ë³µì‚¬í•˜ê¸°</button>
  </div>
  <pre id="outputArea"></pre>

  <script>
    function convertUrls() {
      const input = document.getElementById('inputArea').value.trim();
      if (!input) {
        alert('Custom log (tenhou.net/6 JSON) ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
      }

      const lines = input.split('\n');
      const combinedLogs = [];
      let firstData = null;
      const errors = [];

      lines.forEach((line, idx) => {
        const trimmed = line.trim();
        if (trimmed === '') return; // ë¹ˆ ì¤„ ë¬´ì‹œ

        try {
          const jsonStr = trimmed.replace(/^https:\/\/tenhou\.net\/6\/#json=/, '');
          const data = JSON.parse(jsonStr);

          if (data.title?.[0]?.[0]) {
            data.title[0][0] = data.title[0][0].replace(/æ±/g, 'å—');
          }
          if (data.rule?.disp) {
            data.rule.disp = data.rule.disp.replace(/æ±/g, 'å—');
          }

          if (Array.isArray(data.log) && data.log.length > 0 && Array.isArray(data.log[0]) && Array.isArray(data.log[0][0])) {
            data.log[0][0][0] += 4;
          }

          if (!firstData) {
            firstData = data;
          }

          combinedLogs.push(...data.log);

        } catch (e) {
          errors.push(`âš ï¸ ${idx + 1}ë²ˆì§¸ ì¤„ ë³€í™˜ ì‹¤íŒ¨: ${e.message}\nğŸ‘‰ ì›ë³¸: ${trimmed}`);
        }
      });

      if (!firstData) {
        document.getElementById('outputArea').textContent = 'ë³€í™˜í•  ìœ íš¨í•œ JSON ë°ì´í„°ê°€ ì—†ì–´ìš”!';
        return;
      }

      firstData.log = combinedLogs;
      const resultJson = JSON.stringify(firstData);

      // "]]]," íŒ¨í„´ì„ ì°¾ì•„ì„œ ì¤„ë°”ê¿ˆìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
      const formattedResult = resultJson.replace(/\]\],/g, ']],\n\n');

      if (errors.length > 0) {
        document.getElementById('outputArea').textContent = errors.join('\n\n') + '\n\n==== ë³€í™˜ëœ ê²°ê³¼ ====\n\n' + formattedResult;
      } else {
        document.getElementById('outputArea').textContent = formattedResult;
      }
    }

    function copyResult() {
      const output = document.getElementById('outputArea').textContent;
      if (!output) {
        alert('ë³µì‚¬í•  ë³€í™˜ ê²°ê³¼ê°€ ì—†ì–´ìš”!');
        return;
      }

      navigator.clipboard.writeText(output).then(() => {
        alert('ë³€í™˜ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ëì–´ìš”!');
      }).catch(() => {
        alert('ë³µì‚¬ ì‹¤íŒ¨! ì§ì ‘ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ë´ìš”.');
      });
    }
  </script>
</body>
</html>


